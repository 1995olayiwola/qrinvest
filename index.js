var express = require('express');
var ParseServer = require('parse-server').ParseServer;
var ParseDashboard = require('parse-dashboard');
var path = require('path');
var app = express();
require('dotenv').config();


const dbConn = 'mongodb+srv://olatechbus95:olatechbus95@cluster0.43wjd.mongodb.net/?retryWrites=true&w=majority';
const APP_ID = 'qrInvestment';
const MASTER_KEY = 'qrInvestmentMaster';
const REST_API_KEY ='qrInvestmentRest';
const SERVER_URL = 'http://localhost:1337/parse'
//https://dreaminvestment-b52297c0d397.herokuapp.com
// 'https://qrinvest.onrender.com/parse'
const api = new ParseServer({
  databaseURI:dbConn,
  cloud:__dirname + '/cloud/main.js',
  appId:APP_ID,
  masterKey:MASTER_KEY,
  restApiKey:REST_API_KEY,
  serverURL:SERVER_URL,
  liveQuery:{
    classNames:['Task']
  }

})

 api.start();
app.use('/parse',api.app)
//dashboard
var options = { allowInsecureHTTP: false};
var dashboard = ParseDashboard(
  {
    apps: [
      {
        serverURL:SERVER_URL,
        appId: APP_ID,
        masterKey: MASTER_KEY,
        appName: 'Q Invest'
      }
    ],
    users: [
      {
        user: 'olatechbus95@gmail.com',
        pass: 'olatechbus95'
      }
    ],
    trustProxy: 1
  },
  options
);
app.use('/dashboard', dashboard);


// routing
app.get('/', (req, res) => {
  res.send('Parse Server is up again.');
});
app.get('/test', (req, res) => {
  res.sendFile(path.join(__dirname, '/public/test.html'));
});

var port = process.env.PORT || 1337;
var httpServer = require('http').createServer(app);
httpServer.listen(port, () => {
  console.log('parse server is running on port ' + port);
});

// Live Query:
ParseServer.createLiveQueryServer(httpServer);































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































